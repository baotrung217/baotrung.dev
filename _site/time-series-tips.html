<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

	<!-- block search indexing -->
	<meta name="robots" content="noindex">
	<meta name="googlebot" content="noindex">

  <!-- bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" async>

  <!-- fontawesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous" async>

  <!-- google fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin async >
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&display=swap" rel="stylesheet" crossorigin async>
  <link href="https://fonts.googleapis.com/css?family=Livvic:400,400i,500,500i,600&display=swap&subset=vietnamese" rel="stylesheet" crossorigin async>
  <link href="https://fonts.googleapis.com/css?family=Lobster&display=swap" rel="stylesheet" crossorigin async>

  <link rel="alternate" hreflang="en" href="/time-series-tips" async />

  <link rel="shortcut icon" type="image/x-icon" href="/img/avatar-icon.ico" async>
  <meta name="author" content="Nguyễn Bảo Trung" />

  <title>
    
      Trung | Time Series extra
    
  </title>

  

  <!-- feed -->
  <link rel="alternate" type="application/rss+xml" title="Nguyễn Bảo Trung - " href="/feed.xml" async />

  <!-- page (internal) -->
  

  <!-- layout (internal) -->
  
    
      <link rel="stylesheet" href="/css/main.css" async />
    
      <link rel="stylesheet" href="/css/rouge-thi.css" async />
    
  
  

    <!-- Facebook OpenGraph tags -->
  

  
    <meta property="fb:admins" content="baotrung217zzz"/>
  

  
    <meta property="og:title" content="Time Series extra" />
  

  
    <meta property="og:description" content="Terminologies &amp;amp; fields of research Read_CSV Find the windows of time series Terminologies &amp;amp; fields of research Burst detection: An unexpectedly large number of events occurring within some certain temporal or spatial region is called a burst, suggesting unusual behaviors or activities. Time Series Regression: [ref] Time series regression is...">
  


  <meta property="og:type" content="website" />

  
    <meta property="og:url" content="http://localhost:4000/time-series-tips" />
    <link rel="canonical" href="http://localhost:4000/time-series-tips" async />
  

  <meta property="og:image" content="http://localhost:4000/img/background.png" />
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1234">
  <meta property="og:image:height" content="592">

  

  

  

  

</head>


<body>
  <script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '',
      xfbml      : true,
      version    : 'v3.1'
    });
  
    FB.AppEvents.logPageView();
  
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>
  <header>
    <nav class="navbar navbar-dark nav-bg navbar-custom fixed-top">
  <div class="container">
    <div class="col-12 col-lg-10 offset-lg-1">
      <div class="nav-container">
        <a class="nav-item" href="http://localhost:4000/">
          <i style="color: #ffeead;" class="fas fa-home" aria-hidden="true"></i>
          <span>Home</span>
        </a>
        <a class="nav-item" href="http://localhost:4000/about">
          <i style="color: #e97c8e;" class="fas fa-fire" aria-hidden="true"></i>
          <span>Me</span>
        </a>
        <a class="nav-item" href="http://localhost:4000/notes">
          <i style="color: #93ceff;" class="fas fa-edit" aria-hidden="true"></i>
          <span>Notes</span>
        </a>
        <div class="nav-search">
          <form action="http://localhost:4000/search" method="get">
            <button class="nav-search-submit" type="submit">
              <i class="fa fa-search" aria-hidden="true"></i>
            </button>
            <input name="q" class="nav-search-input" type="search" placeholder="search notes..." aria-label="search notes...">
          </form>
        </div>
        <a class="nav-item nav-github" href="https://github.com/baotrung217" target="_blank">
          <i class="fab fa-github"></i>
        </a>
    </div>
    </div>
  </div>
</nav>

  </header>

  
  <header class="header">
    <div class="container">
      <div class="row align-items-center justify-content-center">
        <div class="col-md-8 header-content">
          
          
            <div class="icon-photo">
              <img src="http://localhost:4000/img/header/ts.png">
            </div>
          
          <h1 class="post-title">
            Time Series extra<sup>•</sup>
          </h1>
          
            <div class="tag-in-post">
              
              
                
                
                
                
                
                  <a href="/tags#algorithm">
                    algorithm
                  </a>
                

              
                
                
                
                
                
                  <a href="/tags#extra">
                    extra
                  </a>
                

              
                
                
                
                
                
                  <a href="/tags#time-series">
                    time series
                  </a>
                

              
            </div>
          
          <p>
            
              10 Mar 2020
                        
          </p>
        </div>
      </div>
    </div>
  </header>


<main role="main">
  <section class="section">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-10 col-xl-9">
          <article  class="page-content ">
            <p style="font-style: italic; color: #777; font-size: 0.95rem; margin-bottom: 2rem;">
  Last modified on 01 May 2022.
</p>



<div id="toc">
  <div class="toc-content">
<ul id="markdown-toc">
  <li><a href="#terminologies--fields-of-research" id="markdown-toc-terminologies--fields-of-research">Terminologies &amp; fields of research</a></li>
  <li><a href="#read_csv" id="markdown-toc-read_csv">Read_CSV</a></li>
  <li><a href="#find-the-windows-of-time-series" id="markdown-toc-find-the-windows-of-time-series">Find the windows of time series</a></li>
</ul>

  </div>
</div>

<h2 id="terminologies--fields-of-research">Terminologies &amp; fields of research</h2>

<ul>
  <li><strong>Burst detection</strong>: An unexpectedly large number of events occurring within some certain temporal or spatial region is called
a burst, suggesting unusual behaviors or activities.</li>
  <li><strong>Time Series Regression</strong>: <sup><a href="https://ch.mathworks.com/discovery/time-series-regression.html " target="_blank">[ref]</a></sup>
 Time series regression is a statistical method for predicting a future response based on the response history (known as autoregressive dynamics) and the transfer of dynamics from relevant predictors. Time series regression can help you understand and predict the behavior of dynamic systems from experimental or observational data. Time series regression is commonly used for modeling and forecasting of economic, financial, and biological systems.</li>
  <li><strong>Time Series Classification</strong>: <sup><a href="https://medium.com/datadriveninvestor/time-series-classification-using-feature-extraction-16209570a22e " target="_blank">[ref]</a></sup>
 Time series classification deals with classifying the data points over the time based on its’ behavior. There can be data sets which behave in an abnormal manner when comparing with other data sets. Identifying unusual and anomalous time series is becoming increasingly common for organizations
    <ul>
      <li><sup><a href="https://www.analyticsvidhya.com/blog/2019/01/introduction-time-series-classification/ " target="_blank">[ref]</a></sup>
 Time series classification data differs from a regular classification problem since the attributes have an ordered sequence.</li>
    </ul>
  </li>
  <li><strong>Anomaly Detection</strong>:
    <ul>
      <li>A part in the same time series.</li>
      <li>Finding one or more time series which are different from others.</li>
      <li>Some abnormal points in the same time series.</li>
      <li>Applied for both univariate and multivariate time series.</li>
    </ul>
  </li>
</ul>

<h2 id="read_csv">Read_CSV</h2>

<p>More <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html">here</a>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_13</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_file</span><span class="p">,</span>
                    <span class="n">index_col</span><span class="o">=</span><span class="s">'timestamp'</span><span class="p">,</span>
                    <span class="n">parse_dates</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="c1"># index contains dates
</span>                    <span class="n">infer_datetime_format</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="c1"># auto regconize format
</span>                    <span class="n">cache_dates</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># faster
</span></code></pre></div></div>

<h2 id="find-the-windows-of-time-series">Find the windows of time series</h2>

<p>Suppose we have data like in below, we wanna find the common length interval of all groups.</p>

<p class="img-full-100"><img src="/img/post/time-series/ts-interval-example.png" alt="Group of time series intervals" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># find the biggest gap
</span><span class="n">df</span><span class="p">[</span><span class="s">'date'</span><span class="p">].</span><span class="n">diff</span><span class="p">().</span><span class="nb">max</span><span class="p">()</span>

<span class="c1"># 4 biggest gaps
</span><span class="n">df</span><span class="p">[</span><span class="s">'date'</span><span class="p">].</span><span class="n">diff</span><span class="p">().</span><span class="n">sort_values</span><span class="p">().</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span>

<span class="c1"># starting of each window (the gap used to separate windows is '1D')
</span><span class="n">w_starts</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="o">~</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'date'</span><span class="p">].</span><span class="n">diff</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="s">'1D'</span><span class="p">))].</span><span class="n">index</span>

<span class="c1"># ending of each window
</span><span class="n">w_ends</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_starts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">).</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="p">.</span><span class="n">Index</span><span class="p">([</span><span class="n">df</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

<span class="c1"># count the number of windows
</span><span class="nb">len</span><span class="p">(</span><span class="n">w_starts</span><span class="p">)</span>

<span class="c1"># the biggest/average window size (in points)
</span><span class="p">(</span><span class="n">w_ends</span> <span class="o">-</span> <span class="n">w_starts</span><span class="p">).</span><span class="nb">max</span><span class="p">()</span>
<span class="p">(</span><span class="n">w_ends</span> <span class="o">-</span> <span class="n">w_starts</span><span class="p">).</span><span class="n">values</span><span class="p">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># the biggest window size (in time range)
</span><span class="n">pd</span><span class="p">.</span><span class="n">Timedelta</span><span class="p">((</span><span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">w_ends</span><span class="p">][</span><span class="s">'date'</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">w_starts</span><span class="p">][</span><span class="s">'date'</span><span class="p">]).</span><span class="nb">max</span><span class="p">(),</span> <span class="n">unit</span><span class="o">=</span><span class="s">'ns'</span><span class="p">)</span>
</code></pre></div></div>

<p>If you wanna add a <code class="language-plaintext highlighter-rouge">window</code> column to the original dataframe,</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_tmp</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">w_idx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w_starts</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">df_tmp</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">w_starts</span><span class="p">[</span><span class="n">i</span><span class="p">]:(</span><span class="n">w_ends</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="s">'window'</span><span class="p">]</span> <span class="o">=</span> <span class="n">w_idx</span>
    <span class="n">w_idx</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">df_tmp</span><span class="p">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="c1"># convert dtype to int64
</span></code></pre></div></div>

<p>There are other cases need to be considered,</p>

<p class="img-full-100"><img src="/img/post/time-series/ts-interval-example-2.png" alt="Group of time series intervals" />
<em>The gaps are not regular</em></p>

<p class="img-full-100"><img src="/img/post/time-series/ts-interval-example-3.png" alt="Group of time series intervals" />
<em>If we choose the gaps (to determine the windows) too small, there are some windows have only 1 point like in this case.</em></p>

<p>Find the gap’s threshold automatically,</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">MeanShift</span>

<span class="k">def</span> <span class="nf">find_gap_auto</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'date'</span><span class="p">].</span><span class="n">diff</span><span class="p">().</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="p">.</span><span class="n">isnat</span><span class="p">(</span><span class="n">X</span><span class="p">)]</span> <span class="c1"># remove 'NaT'
</span>    <span class="n">X</span><span class="p">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">clustering</span> <span class="o">=</span> <span class="n">MeanShift</span><span class="p">().</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">clustering</span><span class="p">.</span><span class="n">labels_</span>
    <span class="n">cluster_min</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">gap</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">to_timedelta</span><span class="p">((</span><span class="n">X</span><span class="p">[</span><span class="n">labels</span><span class="o">!=</span><span class="n">cluster_min</span><span class="p">].</span><span class="nb">min</span><span class="p">()</span> <span class="o">+</span> <span class="n">X</span><span class="p">[</span><span class="n">labels</span><span class="o">==</span><span class="n">cluster_min</span><span class="p">].</span><span class="nb">max</span><span class="p">())</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">gap</span>
</code></pre></div></div>


<!-- <div class="box-error">
<h4>Notice an error?</h4>
Everything on this site is <a href="https://github.com/baotrung217/dinhanhthi.com" target="_blank">published</a> on Github. If you find something wrong, <a href="https://github.com/dinhanhthi/dinhanhthi.com/edit/master/_posts/time-series/2020-03-10-time-series-tips.md" target="_blank">just edit it</a> or <a href="mailto:baotrung217@gmail.com?subject=Suggest to edit post 'Time Series extra'">tell me</a> about it.
</div> -->

<div class="sec-comment">

  
    <p style="font-style: italic; color: #777; font-size: 0.95rem; margin-bottom: 1rem;">
      <sup style="color: #bbb">•</sup>Notes with this notation aren't good enough. They are being updated. <span style="color: white;">If you can see this, you are so smart. ;)</span>
    </p>
  

  <button class="btn btn-info w-100" id="show-comments" onclick="load_comment();return false;">
    If you find something wrong or need a comment, click here.
  </button>

  <div id='comment-box' style="display: none;">
    <script src="https://utteranc.es/client.js"
            repo="dinhanhthi/dinhanhthi.com"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
    </script>
  </div>

  <script>
    var comment_loaded = false;
    function load_comment() {
        if (!comment_loaded)  {
            comment_loaded = true;
            document.getElementById("show-comments").style.display = "none";
            document.getElementById("comment-box").style.display = "block";
        }
    }
  </script>
</div>

<div class="modal fade" id="imagemodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg modal-xl">
    <div class="modal-content">
      <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <img src="" class="imagepreview" style="width: 100%;" >
      </div>
    </div>
  </div>
</div>



          </article >
        </div>
      </div>
    </div>
  </section>
</main>



  <footer class="footer">
    <div class="container">
  <div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-6 text-center p-3">
      <div class="footer-info">
        <a href="https://baotrung.dev" target="_blank">Trung</a>
        &nbsp;&copy;&nbsp;
        2022
        &nbsp;&bull;&nbsp;
        <a href="http://localhost:4000/about-the-notes">
          About the notes
        </a>
        &nbsp;&bull;&nbsp;
        <a href="https://pobo.dinhanhthi.com" target="_blank">
          Po Bo
        </a>
        &nbsp;&bull;&nbsp;
        <a href="/for-me-only">
          For me only
        </a>
        &nbsp;&bull;&nbsp;
        <a class="donate" href="http://localhost:4000/donate">
          Support Trung
        </a>
      </div>
    </div>
  </div>
</div>

  </footer>

  





  

  <script src="https://code.jquery.com/jquery-1.10.1.min.js" integrity="sha256-SDf34fFWX/ZnUozXXEH0AeB+Ip3hvRsjLwp6QNTEb3k=" crossorigin="anonymous" async></script>

  <!-- scrolling-toc -->
  <script src="http://localhost:4000/js/scrolling-toc.js" type="text/javascript" async></script>

  <!-- bootstrap -->
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous" async></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous" async></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous" async></script>

  <script src="http://localhost:4000/js/click_to_zoom.js" async></script>

  <script src="http://localhost:4000/js/anchor.js" async></script>

</body>
</html>
